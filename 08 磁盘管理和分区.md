# 磁盘管理和分区

- tract：磁道

- sector：扇区

- header：磁头

- cylinder：柱面

Linux系统中，磁盘以文件形式保存在/dev目录下，文件名以hd或sd开头（IDE设备以hd开头，usb、sata、SCSI、SAS等设备以sd开头），以a、b、c等表示编号，如第一块硬盘叫做/dev/sda，第二块叫做/dev/sdb，以此类推

分区使用设备名+分区号形式表示，如第一个磁盘的第一个分区：/dev/sda1，第二个分区：/dev/sda2

**分区类型：**

* 主分区：一块硬盘最多4个，用来启动系统，可以建立文件系统，存放数据，不能再分小区。当有多个主分区时，只有一个是活动的

* 扩展分区：一块硬盘只有一个，加上主分区只能有4个，不能建立文件系统，可以再分区

* 逻辑分区：可以建立文件系统，存放数据

## du

查看文件和目录使用的磁盘空间，不加选项默认是当前目录下的所有目录

| 命令  |                 作用                 |
| :---: | :----------------------------------: |
| du -s | 列出总量，不列出各分类目录的占用总量 |
| du -a |        列出所有文件和目录总量        |
| du -h |   以较易阅读的容量格式（G/M）显示    |

## df

显示文件系统的磁盘剩余空间和已用空间，不加选项默认是所有的文件系统

| 命令  |                        作用                        |
| :---: | :------------------------------------------------: |
| df -a |             列出所有文件系统的使用情况             |
| df -h | 以较易阅读的 GBytes, MBytes, KBytes 等格式自行显示 |
| df -T |                  显示文件系统类型                  |

*df和du的区别在于前者的对象是文件系统，后者是文件或目录本身*

显示内存的使用情况，以兆为单位

```shell
free -m 

#free -h
```

## fdisk

分区工具，几乎所有的Linux系统都默认安装

列出所有安装的磁盘和分区信息

```shell
fdisk -l
```

指定磁盘分区

```shell
fdisk /dev/sda
```

进入fdisk的交互界面，输入m查看menu帮助，n创建新分区，p查看当前分区，t修改分区编号，w写入磁盘并退出，q不保存更改退出。fdisk分区后需要使用partprobe让内核识别新的分区

**swap**：虚拟内存，把磁盘空间当作内存使用，用于内存不够的情况

## 磁盘格式化

```shell
mkfs [-t 文件系统格式] 装置文件名
```

文件系统格式：如 ext3, ext2, vfat 等

## 磁盘检验

用来检查和维护不一致的文件系统，若系统掉电或磁盘发生问题，可利用fsck命令对文件系统进行检查

```bash
fsck [-t 文件系统] [-ACay] 装置名称
```

| 选项 |                        作用                        |
| :--: | :------------------------------------------------: |
|  -t  |                 指定文件系统的格式                 |
|  -s  |                 依序执行指令来检查                 |
|  -A  | 对/etc/fstab 中所有列出来的分区（partition）做检查 |
|  -C  |                 显示完整的检查进度                 |
|  -d  |            打印出 e2fsck 的 debug 结果             |
|  -p  |     同时有 -A 条件时，多个 fsck 的检查一起执行     |
|  -R  |          同时有 -A 条件时，省略 / 不检查           |
|  -V  |                    详细显示模式                    |
|  -a  |               如果检查有错则自动修复               |
|  -r  |             如果检查有错则询问是否修复             |
|  -y  |                    全部检查修复                    |

## 磁盘挂载与卸除

Linux 的磁盘挂载使用mount命令，卸载使用 umount命令

磁盘挂载

```bash
mount [-t 文件系统] [-L Label名] [-o 额外选项] [-n]  装置文件名  挂载点
```

磁盘卸载

```bash
umount [-fn] 装置文件名或挂载点
```

| 选项 |            作用             |
| :--: | :-------------------------: |
|  -f  |          强制卸除           |
|  -n  | 不升级 /etc/mtab 情况下卸除 |

